import"../chunks/CWj6FrbW.js";import{o as xr,s as p}from"../chunks/BpDpeONt.js";import{i as fr,s as B,j as X,t as v,f as gr,n as e,l as r,m as n,u as S,g as c,k as br,o as x,$ as yr,r as t,v as fe}from"../chunks/BxrbYPPH.js";import{i as g}from"../chunks/C_-0o-f2.js";import{e as Ie,i as Ne}from"../chunks/n-s4RcA1.js";import{h as hr}from"../chunks/0AlaG3wI.js";import{d as wr,h as kr,r as xt,e as ft}from"../chunks/DKpueC4a.js";import{b as $r,a as U,r as Ve}from"../chunks/BGk8CD_Q.js";import{b as he,c as Rr}from"../chunks/vV7d1D-f.js";import{b as qr}from"../chunks/DUXZVHcJ.js";import"../chunks/B9AC9LgO.js";import{c as gt}from"../chunks/Dcrl4MPd.js";import{g as Sr,a as Er}from"../chunks/C6eE29Wt.js";import{c as He,s as E,a as we}from"../chunks/iREZRceN.js";import{g as Fe,E as F,v as Mr,S as bt}from"../chunks/C2t0hFGI.js";import{s as jr}from"../chunks/3os2E0c7.js";import{g as Ke}from"../chunks/CCryTnhq.js";import"../chunks/69_IOA4Y.js";import{R as Dr}from"../chunks/DgJjuvVc.js";import{R as zr}from"../chunks/DpfUluG8.js";import{R as Or}from"../chunks/BmUo1YTu.js";import"../chunks/CYBAZs4S.js";import{H as Lr}from"../chunks/CATT0rBV.js";import{M as yt}from"../chunks/IkWuq9-R.js";import{S as ht}from"../chunks/BGsAgnpI.js";import{o as wt}from"../chunks/Bxbzq6E6.js";const Cr=(z,u)=>{const O=Array.from(z.target.files||[]),b=10*1024*1024,te=5;if(e(u).length+O.length>te){E("error",`최대 ${te}개의 파일만 첨부할 수 있습니다.`);return}const ne=O.filter(oe=>oe.size>b?(E("error",`${oe.name}은(는) 10MB를 초과합니다.`),!1):!0);x(u,[...e(u),...ne],!0)},Pr=(z,u,O,b,te,ne)=>{if(He(u)){if(e(O).status!=="open"){E("error","마감된 요청입니다.");return}if(e(O).requester_id===b.id){E("error","자신의 요청에는 제안할 수 없습니다.");return}if(e(te).some(oe=>oe.expert_id===b.id)){E("error","이미 제안하셨습니다.");return}x(ne,!0)}},kt=(z,u,O,b,te)=>{e(u)?x(O,{rating:e(u).rating,title:e(u).title||"",content:e(u).content||""},!0):b(),x(te,!0)};var Tr=v('<meta name="description">'),Ar=v('<button slot="left" aria-label="이전 페이지로 돌아가기"><!></button>'),Br=v('<h1 slot="center" class="font-semibold">전문가 요청</h1>'),Ur=v('<div class="mb-2"><span class="inline-flex items-center rounded-md bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600"> </span></div>'),Ir=v('<div class="mb-4 rounded-lg border border-red-200 bg-red-50 p-4"><h3 class="mb-2 text-sm font-semibold text-red-900">거절 사유</h3> <p class="text-sm text-red-700"> </p></div>'),Nr=v('<div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">의뢰인 지불</span> <span class="font-medium text-gray-900"> </span></div> <div class="flex justify-between"><span class="text-gray-600">플랫폼 수수료 (5%)</span> <span class="text-gray-400"> </span></div> <div class="flex justify-between border-t border-gray-200 pt-2"><span class="font-semibold text-gray-900">정산 금액</span> <span class="text-lg font-semibold text-blue-600"> </span></div></div>'),Vr=v('<span class="text-lg font-medium text-blue-600"> </span>'),Fr=v('<div class="flex items-center text-sm"><span class="w-20 text-gray-500">마감일</span> <span class="font-medium text-gray-900"> </span></div>'),Hr=v('<div class="flex items-center text-sm"><span class="w-20 text-gray-500">예상 기간</span> <span class="font-medium text-gray-900"> </span></div>'),Kr=(z,u)=>e(u).users?.handle&&Ke(`/@${e(u).users.handle}`),Gr=v('<img class="aspect-square h-6 w-6 rounded-full" loading="lazy" width="24" height="24">'),Zr=v('<div class="flex h-6 w-6 items-center justify-center rounded-full bg-gray-200"><span class="text-xs text-gray-500"> </span></div>'),Qr=(z,u)=>u(),Xr=v('<button class="rounded-lg bg-emerald-600 px-3 py-1.5 text-xs font-medium text-white transition-colors hover:bg-emerald-700" aria-label="프로젝트 완료하기">완료</button>'),Jr=v('<div class="mb-4 px-4"><div class="rounded-xl border border-emerald-100 bg-emerald-50 p-4"><div class="flex items-center gap-3"><div class="flex h-8 w-8 items-center justify-center rounded-full bg-emerald-100"><svg class="h-4 w-4 text-emerald-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></div> <div class="flex-1"><p class="text-sm font-semibold text-emerald-800">제안이 수락되었습니다!</p> <p class="text-xs text-emerald-700">선택된 전문가와 프로젝트를 진행해보세요.</p></div> <!></div></div></div>'),Wr=v('<button class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700" aria-label="전문가 리뷰 작성하기">리뷰 작성</button>'),Yr=v('<div class="rounded-lg border border-gray-100 bg-gray-50 p-4"><div class="mb-2 flex items-center gap-2"><!> <span class="text-sm font-medium text-gray-600"> </span></div> <h4 class="mb-2 font-semibold text-gray-900"> </h4> <p class="mb-3 text-sm text-gray-600"> </p> <div class="flex items-center justify-between text-xs text-gray-400"><span> </span> <button class="text-blue-600 hover:text-blue-700" aria-label="리뷰 수정하기">수정</button></div></div>'),ea=v('<p class="text-sm text-gray-600">리뷰를 작성하려면 프로젝트가 완료되어야 합니다.</p>'),ta=v('<p class="text-sm text-gray-600">프로젝트가 완료되었습니다. 전문가에게 리뷰를 남겨주세요!</p>'),ra=v('<div class="mb-4 px-4"><div class="rounded-xl border border-gray-200 bg-white p-4"><div class="mb-3 flex items-center justify-between"><h3 class="font-semibold text-gray-900">전문가 리뷰</h3> <!></div> <!></div></div>'),aa=(z,u)=>e(u).users?.handle&&Ke(`/@${e(u).users.handle}`),sa=v('<img class="h-full w-full object-cover" loading="lazy" width="32" height="32">'),ia=v('<span class="text-xs text-gray-500"> </span>'),oa=(z,u)=>e(u).users?.handle&&Ke(`/@${e(u).users.handle}`),na=v('<span class="inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600"><svg class="mr-1 h-3 w-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> 비밀</span>'),la=(z,u,O)=>{u(e(O).contact_info)},da=v('<button class="rounded-lg bg-blue-50 px-3 py-1.5 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-100" aria-label="연락처 복사하기">문의하기</button>'),ca=v('<span class="rounded-full bg-emerald-50 px-2 py-1 text-xs font-medium text-emerald-600">✓ 수락됨</span>'),va=v('<span class="rounded-full bg-gray-50 px-2 py-1 text-xs font-medium text-gray-500">거절됨</span>'),_a=(z,u,O)=>u(e(O).id),ua=v('<button class="rounded-lg bg-emerald-50 px-3 py-1.5 text-xs font-medium text-emerald-600 transition-colors hover:bg-emerald-100">수락</button>'),ma=v('<div class="mb-3 rounded-lg border border-gray-200 bg-gray-50 p-3"><div class="flex items-center gap-2"><svg class="h-4 w-4 text-gray-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg> <span class="text-sm font-medium text-gray-600">비밀제안</span></div> <p class="mt-2 text-xs text-gray-500">이 제안은 의뢰인과 제안 작성자만 내용을 확인할 수 있습니다.</p></div>'),pa=v('<p class="overflow-wrap-anywhere mb-3 text-sm leading-relaxed break-words whitespace-pre-line text-gray-600"> </p>'),xa=v('<a target="_blank" class="flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2 transition-colors hover:bg-gray-100"><span class="text-base">📄</span> <div class="min-w-0 flex-1"><p class="truncate text-xs font-medium text-gray-700"> </p> <p class="text-xs text-gray-500"> </p></div> <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></a>'),fa=v('<div class="mb-3"><p class="mb-2 text-xs font-medium text-gray-600">첨부파일</p> <div class="space-y-2"></div></div>'),ga=v('<div class="flex items-center gap-4 text-xs text-gray-500"><span class="flex items-center gap-1"><span>📞</span> <span class="font-medium"> </span></span></div>'),ba=v('<div class="rounded-xl border border-gray-100 p-4 transition-colors hover:bg-gray-50/50"><div class="mb-3 flex items-start gap-3"><button class="flex h-8 w-8 items-center justify-center overflow-hidden rounded-full bg-gray-200 transition-opacity hover:opacity-80"><!></button> <div class="flex-1"><div class="flex items-center gap-2"><button class="text-sm font-medium text-gray-900 transition-colors hover:text-blue-600"> </button> <!></div> <p class="text-xs text-gray-500"> </p></div> <div class="flex items-center gap-2"><!> <!> <!></div></div> <!> <!> <!></div>'),ya=v('<div class="space-y-3"></div>'),ha=v('<div class="py-8 text-center"><div class="mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gray-100"><!></div> <h3 class="mb-2 font-medium text-gray-900">아직 제안이 없어요</h3> <p class="text-sm text-gray-500">첫 번째로 제안해보세요!</p></div>'),wa=(z,u)=>x(u,!1),ka=v('<div class="flex items-center justify-between rounded-lg border border-gray-200 bg-gray-50 p-3"><div class="flex min-w-0 flex-1 items-center gap-2"><span class="text-lg">📄</span> <div class="min-w-0 flex-1"><p class="truncate text-sm font-medium text-gray-700"> </p> <p class="text-xs text-gray-500"> </p></div></div> <button type="button" class="ml-2 text-gray-400 hover:text-red-600"><svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div>'),$a=v('<div class="mt-3 space-y-2"></div>'),Ra=(z,u)=>x(u,!1),qa=v('<div class="p-6"><div class="mb-6 flex items-center justify-between"><h3 class="text-lg font-bold text-gray-900">제안서 작성</h3> <button class="text-gray-400 hover:text-gray-600" aria-label="제안서 작성 모달 닫기"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div> <form><div class="space-y-4"><div><label class="mb-2 block text-sm font-medium text-gray-700">제안 메시지 <span class="text-red-500">*</span></label> <textarea placeholder="프로젝트에 대한 이해도와 작업 계획을 설명해주세요." class="w-full resize-none rounded-lg border border-gray-200 p-3 text-sm focus:outline-none" rows="6" required></textarea></div> <div><label class="mb-2 block text-sm font-medium text-gray-700">연락처 <span class="text-red-500">*</span></label> <input type="text" placeholder="카카오톡 ID, 이메일, 전화번호 등" class="w-full resize-none rounded-lg border border-gray-200 p-3 text-sm focus:outline-none" required> <p class="mt-1 text-xs text-gray-500">제안이 수락되면 의뢰인이 이 연락처로 연락을 드릴 예정입니다.</p></div> <div><label class="mb-2 block text-sm font-medium text-gray-700">이력서/포트폴리오 첨부</label> <input type="file" multiple accept=".pdf,.doc,.docx,.png,.jpg,.jpeg" class="hidden"> <button type="button" class="w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-3 text-sm text-gray-600 transition-colors hover:border-gray-400 hover:bg-gray-100" aria-label="파일 선택하기">📎 파일 선택 (최대 5개, 각 10MB 이하)</button> <p class="mt-1 text-xs text-gray-500">PDF, Word, 이미지 파일을 첨부할 수 있습니다.</p> <!></div> <div class="rounded-lg border border-gray-200 p-4"><div class="flex items-start gap-3"><input type="checkbox" id="secret_proposal" class="mt-1 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"> <div class="flex-1"><label for="secret_proposal" class="cursor-pointer text-sm font-medium text-gray-700">비밀제안</label></div></div></div></div> <div class="mt-6 flex gap-3"><button type="button" class="flex-1 rounded-lg bg-gray-100 py-3 font-medium text-gray-600 transition-colors hover:bg-gray-200">취소</button> <button type="submit" class="flex-1 rounded-lg bg-gray-900 py-3 font-medium text-white transition-colors hover:bg-gray-800">제안하기</button></div></form></div>'),Sa=(z,u)=>x(u,!1),Ea=(z,u)=>x(u,!1),Ma=v('<div class="p-6"><div class="mb-6 flex items-center justify-between"><h3 class="text-lg font-bold text-gray-900"> </h3> <button class="text-gray-400 hover:text-gray-600" aria-label="리뷰 모달 닫기"><!></button></div> <form><div class="space-y-4"><div><label class="mb-2 block text-sm font-medium text-gray-700">별점 <span class="text-red-500">*</span></label> <div class="flex items-center gap-2"><!></div></div> <div><label class="mb-2 block text-sm font-medium text-gray-700">리뷰 제목 <span class="text-red-500">*</span></label> <input type="text" placeholder="리뷰 제목을 입력해주세요" class="w-full rounded-lg border border-gray-200 p-3 text-sm focus:outline-none" required maxlength="100"></div> <div><label class="mb-2 block text-sm font-medium text-gray-700">리뷰 내용 <span class="text-red-500">*</span></label> <textarea placeholder="전문가의 서비스에 대한 솔직한 평가를 남겨주세요" class="w-full resize-none rounded-lg border border-gray-200 p-3 text-sm focus:outline-none" rows="6" required maxlength="1000"></textarea> <p class="mt-1 text-xs text-gray-500"> </p></div></div> <div class="mt-6 flex gap-3"><button type="button" class="flex-1 rounded-lg bg-gray-100 py-3 font-medium text-gray-600 transition-colors hover:bg-gray-200">취소</button> <button type="submit" class="flex-1 rounded-lg bg-blue-600 py-3 font-medium text-white transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-gray-300"> </button></div></form></div>'),ja=v('<!> <main class="min-h-screen bg-gray-50 pb-20"><div class="px-4 pt-4 pb-6"><div class="rounded-xl border border-gray-100/60 bg-white p-5 transition-all"><div class="mb-3 flex items-start justify-between"><div class="flex-1"><!> <h1 class="mt-4 line-clamp-2 text-xl leading-tight font-semibold text-gray-900"> </h1></div> <span> </span></div> <!> <div class="mb-8"><!></div> <div class="mb-4 space-y-3"><!> <div class="flex items-center text-sm"><span class="w-20 text-gray-500">모집인원</span> <span class="font-medium text-gray-900"> </span></div> <div class="flex items-center text-sm"><span class="w-20 text-gray-500">근무지</span> <span class="font-medium text-gray-900"> </span></div> <!></div> <div class="mt-8 flex items-center justify-between text-sm"><button class="-m-1 flex items-center gap-2 rounded-lg p-1 transition-colors hover:bg-gray-50"><!> <span class="font-medium text-gray-700"> </span></button> <span class="text-gray-400"> </span></div></div></div> <div class="px-4 pb-6"><div class="rounded-xl border border-gray-100/60 bg-white p-5"><h3 class="mb-3 font-semibold text-gray-900">프로젝트 설명</h3> <div class="prose prose-sm max-w-none text-sm leading-relaxed text-gray-600"><!></div></div></div> <!> <!> <div class="px-4"><div class="rounded-xl border border-gray-100/60 bg-white p-5"><div class="mb-4 flex items-center justify-between"><h2 class="font-semibold text-gray-900"> </h2> <button class="rounded-lg bg-blue-600 px-3 py-1.5 text-sm font-medium text-white transition-colors hover:bg-blue-700" aria-label="전문가 제안서 작성하기">제안하기</button></div> <!></div></div></main> <!> <!>',1);function as(z,u){fr(u,!0);const O=Sr(),b=Er(),te=a=>({per_project:"건당",per_hour:"시간당",per_page:"장당",per_day:"일당",per_month:"월",per_year:"년"})[a]||"건당";let{expert_request:ne,proposals:oe,user:$t,can_write_review:Rt,review_expert_id:qt,my_review:St}=u.data,l=B(X(ne)),H=B(X(oe)),R=X($t),ge=B(X(Rt)),le=B(X(qt)),L=B(X(St)),ke=B(X({})),se=B(!1),I=B(X({message:"",contact_info:"",is_secret:!1})),J=B(X([])),$e,re=B(!1),de=B(!1),k=B(X({rating:0,title:"",content:""}));const Et=a=>{x(J,e(J).filter((s,o)=>o!==a),!0)},Ge=a=>{if(a===0)return"0 Bytes";const s=1024,o=["Bytes","KB","MB"],i=Math.floor(Math.log(a)/Math.log(s));return Math.round(a/Math.pow(s,i)*100)/100+" "+o[i]},Mt=(a,s)=>{const o=a.substring(a.lastIndexOf(".")),i=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return`${s}_${i}${o}`},jt=async()=>{if(!He(O))return;const a=Mr(e(I));if(a.length>0){E("error",a[0]);return}try{const s=await b.expert_request_proposals.insert({request_id:e(l).id,message:e(I).message,contact_info:e(I).contact_info||null,is_secret:e(I).is_secret},R.id);if(e(J).length>0){const o=Date.now(),i=e(J).map((y,f)=>({path:`${R.id}/${s.id}/${o}_${Mt(y.name,f)}`,file:y})),m=await b.proposal_attachments_bucket.upload_multiple(i);if(m.successful_uploads.length>0){const y=m.successful_uploads.map(f=>{const q=e(J)[f.index];return{proposal_id:s.id,file_url:f.path,file_name:q.name,file_size:q.size,file_type:q.type}});await b.proposal_attachments.insert_multiple(y,R.id)}}E("success",bt.PROPOSAL_SUBMITTED),x(se,!1),x(H,await b.expert_request_proposals.select_by_request_id(e(l).id),!0),x(I,{message:"",contact_info:"",is_secret:!1},!0),x(J,[],!0)}catch(s){console.error("Proposal submission error:",s);let o=F.SERVER_ERROR;s.message.includes("로그인")?o="로그인이 필요합니다.":s.message.includes("마감된")?o=F.REQUEST_NOT_OPEN:s.message.includes("이미")?o=F.ALREADY_PROPOSED:s.message.includes("자신의")?o="자신의 요청에는 제안할 수 없습니다.":s.message.includes("존재하지")&&(o=F.NOT_FOUND),E("error",o)}},Dt=async a=>{try{await navigator.clipboard.writeText(a),E("success","연락처가 클립보드에 복사되었습니다.")}catch{const o=document.createElement("textarea");o.value=a,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),E("success","연락처가 클립보드에 복사되었습니다.")}},ie=()=>R&&e(l).requester_id===R.id,zt=a=>R&&a.expert_id===R.id,Ot=()=>{if(!R)return!1;const a=e(H).find(s=>s.status==="accepted");return a&&a.expert_id===R.id},Re=a=>a.is_secret?R?ie()||zt(a):!1:!0,Lt=async a=>{if(confirm("이 제안을 수락하시겠습니까? 수락 후 프로젝트가 진행됩니다."))try{const s=e(H).find(o=>o.id===a);await b.expert_request_proposals.accept_proposal(a,e(l).id);try{s?.expert_id&&s.expert_id!==R.id&&await b.notifications.insert({recipient_id:s.expert_id,actor_id:R.id,type:"proposal.accepted",resource_type:"expert_request",resource_id:String(e(l).id),payload:{request_id:e(l).id,request_title:e(l).title,proposal_id:a},link_url:`/expert-request/${e(l).id}`})}catch(o){console.error("Failed to insert notification (proposal.accepted):",o)}E("success","제안이 수락되었습니다! 전문가와 프로젝트를 진행해주세요."),x(H,await b.expert_request_proposals.select_by_request_id(e(l).id),!0),x(l,await b.expert_requests.select_by_id(e(l).id),!0)}catch(s){console.error("Proposal acceptance error:",s);let o=F.SERVER_ERROR;s.message.includes("Only the requester")?o=F.UNAUTHORIZED:s.message.includes("not open")?o=F.REQUEST_NOT_OPEN:s.message.includes("does not exist")&&(o=F.NOT_FOUND),E("error",o)}},Ct=async()=>{if(confirm("프로젝트를 완료하시겠습니까?"))try{await b.expert_requests.complete_project(e(l).id),E("success",bt.PROJECT_COMPLETED);const[a,s]=await Promise.all([b.expert_requests.select_by_id(e(l).id),R?.id?b.expert_request_reviews.can_write_review(e(l).id,R.id):Promise.resolve({can_write:!1,expert_id:null})]);x(l,a,!0),x(ge,s.can_write,!0),x(le,s.expert_id,!0)}catch(a){console.error("Project completion error:",a);let s=F.SERVER_ERROR;a.message.includes("Only the requester")?s=F.UNAUTHORIZED:a.message.includes("not in progress")&&(s=F.INVALID_STATUS),E("error",s)}},qe=()=>{x(k,{rating:0,title:"",content:""},!0)},Pt=()=>e(k).rating===0?(E("error","별점을 선택해주세요."),!1):e(k).title.trim()?e(k).content.trim()?!0:(E("error","리뷰 내용을 입력해주세요."),!1):(E("error","리뷰 제목을 입력해주세요."),!1),Tt=async()=>{if(!(!He(O)||e(de)||!Pt()))try{if(x(de,!0),!e(L)&&e(ge)){const a={request_id:e(l).id,reviewer_id:R.id,expert_id:e(le),rating:e(k).rating,title:e(k).title.trim(),content:e(k).content.trim()};await b.expert_request_reviews.insert(a);try{e(le)&&e(le)!==R.id&&await b.notifications.insert({recipient_id:e(le),actor_id:R.id,type:"expert_review.created",resource_type:"expert_request",resource_id:String(e(l).id),payload:{request_id:e(l).id,request_title:e(l).title,rating:e(k).rating,title:e(k).title},link_url:`/expert-request/${e(l).id}`})}catch(s){console.error("Failed to insert notification (expert_review.created):",s)}E("success","리뷰가 작성되었습니다.")}else e(L)&&(await b.expert_request_reviews.update(e(L).id,{rating:e(k).rating,title:e(k).title.trim(),content:e(k).content.trim()}),E("success","리뷰가 수정되었습니다."));x(L,await b.expert_request_reviews.select_by_request_and_reviewer(e(l).id,R.id),!0),x(re,!1),qe()}catch(a){console.error("리뷰 작성/수정 실패:",a),E("error","리뷰 작성에 실패했습니다. 다시 시도해주세요.")}finally{x(de,!1)}},At=async()=>{try{const a=e(H).map(async i=>{const m=await b.proposal_attachments.select_by_proposal_id(i.id);return{proposal_id:i.id,attachments:m}}),s=await Promise.all(a),o={};s.forEach(i=>{o[i.proposal_id]=i.attachments}),x(ke,o,!0)}catch(a){console.error("Failed to load attachments:",a)}};xr(()=>{At()});var Ze=ja();kr(a=>{var s=Tr();S(()=>{yr.title=`${e(l).title??""} | 문`,U(s,"content",e(l).description)}),c(a,s)});var Qe=gr(Ze);Lr(Qe,{$$slots:{left:(a,s)=>{var o=Ar();o.__click=function(...m){jr?.apply(this,m)};var i=r(o);Dr(i,{size:28,get color(){return gt.gray[600]}}),t(o),c(a,o)},center:(a,s)=>{var o=Br();c(a,o)}}});var Se=n(Qe,2),Ee=r(Se),Xe=r(Ee),Me=r(Xe),je=r(Me),Je=r(je);{var Bt=a=>{var s=Ur(),o=r(s),i=r(o,!0);t(o),t(s),S(()=>p(i,e(l).category)),c(a,s)};g(Je,a=>{e(l).category&&a(Bt)})}var We=n(Je,2),Ut=r(We,!0);t(We),t(je);var De=n(je,2),It=r(De,!0);t(De),t(Me);var Ye=n(Me,2);{var Nt=a=>{var s=Ir(),o=n(r(s),2),i=r(o,!0);t(o),t(s),S(()=>p(i,e(l).reject_reason)),c(a,s)};g(Ye,a=>{e(l).status==="cancelled"&&ie()&&e(l).reject_reason&&a(Nt)})}var ze=n(Ye,2),Vt=r(ze);{var Ft=a=>{var s=Nr(),o=r(s),i=n(r(o),2),m=r(i);t(i),t(o);var y=n(o,2),f=n(r(y),2),q=r(f);t(f),t(y);var T=n(y,2),h=n(r(T),2),w=r(h);t(h),t(T),t(s),S((D,M,j)=>{p(m,`₩${D??""}`),p(q,`-₩${M??""}`),p(w,`₩${j??""}`)},[()=>we(e(l).total_with_commission),()=>we(e(l).commission_amount),()=>we(e(l).total_with_commission-e(l).commission_amount)]),c(a,s)},Ht=a=>{var s=Vr(),o=r(s);t(s),S((i,m)=>p(o,`${i??""}
						${m??""}원`),[()=>te(e(l).price_unit),()=>we(e(l).reward_amount)]),c(a,s)};g(Vt,a=>{Ot()&&e(l).commission_amount&&e(l).total_with_commission?a(Ft):a(Ht,!1)})}t(ze);var Oe=n(ze,2),et=r(Oe);{var Kt=a=>{var s=Fr(),o=n(r(s),2),i=r(o,!0);t(o),t(s),S(m=>p(i,m),[()=>new Date(e(l).application_deadline).toLocaleDateString("ko-KR")]),c(a,s)};g(et,a=>{e(l).application_deadline&&a(Kt)})}var Le=n(et,2),tt=n(r(Le),2),Gt=r(tt);t(tt),t(Le);var Ce=n(Le,2),rt=n(r(Ce),2),Zt=r(rt,!0);t(rt),t(Ce);var Qt=n(Ce,2);{var Xt=a=>{var s=Hr(),o=n(r(s),2),i=r(o);t(o),t(s),S((m,y)=>p(i,`${m??""} ~ ${y??""}`),[()=>new Date(e(l).work_start_date).toLocaleDateString("ko-KR"),()=>new Date(e(l).work_end_date).toLocaleDateString("ko-KR")]),c(a,s)};g(Qt,a=>{e(l).work_start_date&&e(l).work_end_date&&a(Xt)})}t(Oe);var at=n(Oe,2),ce=r(at);ce.__click=[Kr,l];var st=r(ce);{var Jt=a=>{var s=Gr();S(o=>{U(s,"src",o),U(s,"alt",`${(e(l).users.name||e(l).users.handle)??""}님의 프로필 사진`)},[()=>wt(e(l).users.avatar_url)]),c(a,s)},Wt=a=>{var s=Zr(),o=r(s),i=r(o,!0);t(o),t(s),S(m=>p(i,m),[()=>(e(l).users?.name||e(l).users?.handle)?.[0]?.toUpperCase()]),c(a,s)};g(st,a=>{e(l).users?.avatar_url?a(Jt):a(Wt,!1)})}var it=n(st,2),Yt=r(it,!0);t(it),t(ce);var ot=n(ce,2),er=r(ot,!0);t(ot),t(at),t(Xe),t(Ee);var Pe=n(Ee,2),nt=r(Pe),lt=n(r(nt),2),tr=r(lt);hr(tr,()=>e(l).description),t(lt),t(nt),t(Pe);var dt=n(Pe,2);{var rr=a=>{var s=Jr(),o=r(s),i=r(o),m=n(r(i),4);{var y=f=>{var q=Xr();q.__click=[Qr,Ct],c(f,q)};g(m,f=>{e(l).status==="in_progress"&&f(y)})}t(i),t(o),t(s),c(a,s)};g(dt,a=>{R&&ie()&&e(H).some(s=>s.status==="accepted")&&a(rr)})}var ct=n(dt,2);{var ar=a=>{var s=ra(),o=r(s),i=r(o),m=n(r(i),2);{var y=h=>{var w=Wr();w.__click=[kt,L,k,qe,re],c(h,w)};g(m,h=>{!e(L)&&e(ge)&&h(y)})}t(i);var f=n(i,2);{var q=h=>{var w=Yr(),D=r(w),M=r(D);ht(M,{get rating(){return e(L).rating},readonly:!0});var j=n(M,2),P=r(j);t(j),t(D);var K=n(D,2),W=r(K,!0);t(K);var A=n(K,2),G=r(A,!0);t(A);var Z=n(A,2),N=r(Z),Y=r(N,!0);t(N);var $=n(N,2);$.__click=[kt,L,k,qe,re],t(Z),t(w),S(ee=>{p(P,`${e(L).rating??""}.0`),p(W,e(L).title),p(G,e(L).content),p(Y,ee)},[()=>new Date(e(L).created_at).toLocaleDateString("ko-KR")]),c(h,w)},T=(h,w)=>{{var D=j=>{var P=ea();c(j,P)},M=j=>{var P=ta();c(j,P)};g(h,j=>{e(ge)?j(M,!1):j(D)},w)}};g(f,h=>{e(L)?h(q):h(T,!1)})}t(o),t(s),c(a,s)};g(ct,a=>{ie()&&e(l).status==="completed"&&a(ar)})}var vt=n(ct,2),_t=r(vt),Te=r(_t),Ae=r(Te),sr=r(Ae);t(Ae);var ir=n(Ae,2);ir.__click=[Pr,O,l,R,H,se],t(Te);var or=n(Te,2);{var nr=a=>{var s=ya();Ie(s,21,()=>e(H),Ne,(o,i)=>{var m=ba(),y=r(m),f=r(y);f.__click=[aa,i];var q=r(f);{var T=d=>{var _=sa();S(C=>{U(_,"src",C),U(_,"alt",`${(e(i).users.name||e(i).users.handle)??""}님의 프로필 사진`)},[()=>wt(e(i).users.avatar_url)]),c(d,_)},h=d=>{var _=ia(),C=r(_,!0);t(_),S(Q=>p(C,Q),[()=>(e(i).users?.name||e(i).users?.handle)?.[0]?.toUpperCase()]),c(d,_)};g(q,d=>{e(i).users?.avatar_url?d(T):d(h,!1)})}t(f);var w=n(f,2),D=r(w),M=r(D);M.__click=[oa,i];var j=r(M,!0);t(M);var P=n(M,2);{var K=d=>{var _=na();c(d,_)};g(P,d=>{e(i).is_secret&&d(K)})}t(D);var W=n(D,2),A=r(W,!0);t(W),t(w);var G=n(w,2),Z=r(G);{var N=d=>{var _=da();_.__click=[la,Dt,i],c(d,_)};g(Z,d=>{ie()&&e(i).contact_info&&d(N)})}var Y=n(Z,2);{var $=d=>{var _=ca();c(d,_)},ee=(d,_)=>{{var C=Q=>{var ae=va();c(Q,ae)};g(d,Q=>{e(i).status==="rejected"&&Q(C)},_)}};g(Y,d=>{e(i).status==="accepted"?d($):d(ee,!1)})}var V=n(Y,2);{var ve=d=>{var _=ua();_.__click=[_a,Lt,i],S(()=>U(_,"aria-label",`${(e(i).users?.name||e(i).users?.handle)??""}님의 제안 수락하기`)),c(d,_)};g(V,d=>{ie()&&e(i).status==="pending"&&e(l).status==="open"&&d(ve)})}t(G),t(y);var be=n(y,2);{var _e=d=>{var _=ma();c(d,_)},ue=d=>{var _=pa(),C=r(_,!0);t(_),S(()=>p(C,e(i).message)),c(d,_)};g(be,d=>{e(i).is_secret&&!Re(e(i))?d(_e):d(ue,!1)})}var me=n(be,2);{var pe=d=>{var _=fa(),C=n(r(_),2);Ie(C,21,()=>e(ke)[e(i).id],Ne,(Q,ae)=>{var xe=xa(),mt=n(r(xe),2),Ue=r(mt),_r=r(Ue,!0);t(Ue);var pt=n(Ue,2),ur=r(pt,!0);t(pt),t(mt),fe(2),t(xe),S((mr,pr)=>{U(xe,"href",mr),U(xe,"download",e(ae).file_name),p(_r,e(ae).file_name),p(ur,pr)},[()=>b.proposal_attachments_bucket.get_public_url(e(ae).file_url),()=>Ge(e(ae).file_size)]),c(Q,xe)}),t(C),t(_),c(d,_)};g(me,d=>{Re(e(i))&&e(ke)[e(i).id]?.length>0&&d(pe)})}var Be=n(me,2);{var ye=d=>{var _=ga(),C=r(_),Q=n(r(C),2),ae=r(Q,!0);t(Q),t(C),t(_),S(()=>p(ae,e(i).contact_info)),c(d,_)};g(Be,d=>{Re(e(i))&&e(i).contact_info&&(ie()||e(i).status==="accepted")&&d(ye)})}t(m),S(d=>{U(f,"aria-label",`${(e(i).users?.name||e(i).users?.handle)??""}님의 프로필 보기`),U(M,"aria-label",`${(e(i).users?.name||e(i).users?.handle)??""}님의 프로필 보기`),p(j,e(i).users?.name||e(i).users?.handle),p(A,d)},[()=>new Date(e(i).created_at).toLocaleDateString("ko-KR",{month:"short",day:"numeric"})]),c(o,m)}),t(s),c(a,s)},lr=a=>{var s=ha(),o=r(s),i=r(o);Or(i,{size:20,get color(){return gt.gray[400]}}),t(o),fe(4),t(s),c(a,s)};g(or,a=>{e(H).length>0?a(nr):a(lr,!1)})}t(_t),t(vt),t(Se);var ut=n(Se,2);{var dr=a=>{yt(a,{get is_modal_open(){return e(se)},modal_position:"bottom",onModalClose:()=>x(se,!1),children:(s,o)=>{var i=qa(),m=r(i),y=n(r(m),2);y.__click=[wa,se],t(m);var f=n(m,2),q=r(f),T=r(q),h=n(r(T),2);xt(h),t(T);var w=n(T,2),D=n(r(w),2);Ve(D),fe(2),t(w);var M=n(w,2),j=n(r(M),2);j.__change=[Cr,J],qr(j,$=>$e=$,()=>$e);var P=n(j,2);P.__click=()=>$e?.click();var K=n(P,4);{var W=$=>{var ee=$a();Ie(ee,21,()=>e(J),Ne,(V,ve,be)=>{var _e=ka(),ue=r(_e),me=n(r(ue),2),pe=r(me),Be=r(pe,!0);t(pe);var ye=n(pe,2),d=r(ye,!0);t(ye),t(me),t(ue);var _=n(ue,2);_.__click=()=>Et(be),t(_e),S(C=>{p(Be,e(ve).name),p(d,C),U(_,"aria-label",`${e(ve).name??""} 파일 제거`)},[()=>Ge(e(ve).size)]),c(V,_e)}),t(ee),c($,ee)};g(K,$=>{e(J).length>0&&$(W)})}t(M);var A=n(M,2),G=r(A),Z=r(G);Ve(Z),fe(2),t(G),t(A),t(q);var N=n(q,2),Y=r(N);Y.__click=[Ra,se],fe(2),t(N),t(f),t(i),ft("submit",f,$=>{$.preventDefault(),jt()}),he(h,()=>e(I).message,$=>e(I).message=$),he(D,()=>e(I).contact_info,$=>e(I).contact_info=$),Rr(Z,()=>e(I).is_secret,$=>e(I).is_secret=$),c(s,i)},$$slots:{default:!0}})};g(ut,a=>{e(se)&&a(dr)})}var cr=n(ut,2);{var vr=a=>{yt(a,{get is_modal_open(){return e(re)},modal_position:"bottom",onModalClose:()=>x(re,!1),children:(s,o)=>{var i=Ma(),m=r(i),y=r(m),f=r(y,!0);t(y);var q=n(y,2);q.__click=[Sa,re];var T=r(q);zr(T,{size:24}),t(q),t(m);var h=n(m,2),w=r(h),D=r(w),M=n(r(D),2),j=r(M);ht(j,{readonly:!1,size:28,get rating(){return e(k).rating},set rating(V){e(k).rating=V}}),t(M),t(D);var P=n(D,2),K=n(r(P),2);Ve(K),t(P);var W=n(P,2),A=n(r(W),2);xt(A);var G=n(A,2),Z=r(G);t(G),t(W),t(w);var N=n(w,2),Y=r(N);Y.__click=[Ea,re];var $=n(Y,2),ee=r($,!0);t($),t(N),t(h),t(i),S(()=>{p(f,e(L)?"리뷰 수정":"리뷰 작성"),p(Z,`${e(k).content.length??""} / 1000자`),$.disabled=e(de),p(ee,e(de)?"제출 중...":e(L)?"수정하기":"작성하기")}),ft("submit",h,V=>{V.preventDefault(),Tt()}),he(K,()=>e(k).title,V=>e(k).title=V),he(A,()=>e(k).content,V=>e(k).content=V),c(s,i)},$$slots:{default:!0}})};g(cr,a=>{e(re)&&a(vr)})}S((a,s,o)=>{p(Ut,e(l).title),$r(De,1,a),p(It,s),p(Gt,`${e(l).max_applicants??""}명`),p(Zt,e(l).work_location),U(ce,"aria-label",`${(e(l).users?.name||e(l).users?.handle)??""}님의 프로필 보기`),p(Yt,e(l).users?.name||e(l).users?.handle),p(er,o),p(sr,`받은 제안 (${e(H).length??""}개)`)},[()=>`ml-3 flex-shrink-0 rounded-md px-2.5 py-1 text-xs font-medium ${Fe(e(l).status).bgColor} ${Fe(e(l).status).textColor}`,()=>Fe(e(l).status).text,()=>new Date(e(l).created_at).toLocaleDateString("ko-KR",{month:"short",day:"numeric"})]),c(z,Ze),br()}wr(["click","change"]);export{as as component};
