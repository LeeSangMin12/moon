import"../chunks/CWj6FrbW.js";import{i as Ot,j as K,t as u,f as D,u as $,g as v,k as Qt,$ as Tt,l as t,m as s,r as e,w as bt,n as xt,e as Ut}from"../chunks/BxrbYPPH.js";import{s as d}from"../chunks/BpDpeONt.js";import{i as h}from"../chunks/C_-0o-f2.js";import{e as Vt,i as Wt}from"../chunks/n-s4RcA1.js";import{d as Xt,h as Yt}from"../chunks/DKpueC4a.js";import{b as Zt}from"../chunks/BGk8CD_Q.js";import{c as te}from"../chunks/Dcrl4MPd.js";import{g as ee,a as ae}from"../chunks/C6eE29Wt.js";import{a as k,s as H}from"../chunks/iREZRceN.js";import{g as at}from"../chunks/CCryTnhq.js";import"../chunks/69_IOA4Y.js";import{R as se}from"../chunks/DgJjuvVc.js";import{H as re}from"../chunks/CATT0rBV.js";const oe=async(L,b,i,g)=>{try{await b.service_orders.approve(i.id),H("success","주문이 승인되었습니다.");try{i.buyer?.id&&await b.notifications.insert({recipient_id:i.buyer.id,actor_id:g.id,type:"order.approved",resource_type:"order",resource_id:String(i.id),payload:{service_title:i.service_title,status:"paid"},link_url:`/@${i.buyer.handle}/accounts/orders/${i.id}`})}catch(w){console.error("Failed to insert notification (order.approved):",w)}i.status="paid"}catch(w){console.error("주문 승인 실패:",w),H("error","주문 승인에 실패했습니다.")}},ie=async(L,b,i,g)=>{try{await b.service_orders.complete(i.id),H("success","서비스가 완료되었습니다.");try{i.buyer?.id&&await b.notifications.insert({recipient_id:i.buyer.id,actor_id:g.id,type:"order.completed",resource_type:"order",resource_id:String(i.id),payload:{service_title:i.service_title,status:"completed"},link_url:`/@${i.buyer.handle}/accounts/orders/${i.id}`})}catch(w){console.error("Failed to insert notification (order.completed):",w)}i.status="completed"}catch(w){console.error("주문 완료 실패:",w),H("error","주문 완료에 실패했습니다.")}},et=async(L,b,i,g,w)=>{const z=prompt("취소 사유를 입력해주세요.");if(z)try{await b.service_orders.cancel(i.id,z),H("success","주문이 취소되었습니다.");try{const j=g?i.seller.id:i.buyer.id,B=g?i.seller.handle:i.buyer.handle;j&&await b.notifications.insert({recipient_id:j,actor_id:w.id,type:"order.cancelled",resource_type:"order",resource_id:String(i.id),payload:{service_title:i.service_title,status:"cancelled"},link_url:`/@${B}/accounts/orders/${i.id}`})}catch(j){console.error("Failed to insert notification (order.cancelled):",j)}i.status="cancelled"}catch(j){console.error("주문 취소 실패:",j),H("error","주문 취소에 실패했습니다.")}};var ne=()=>history.back(),le=u('<button slot="left"><!></button>'),ce=u('<h1 slot="center" class="font-semibold">주문 상세</h1>'),de=u('<div class="flex justify-between"><span class="text-gray-600">쿠폰 보전 (플랫폼 부담)</span> <span class="font-medium text-blue-600"> </span></div>'),ve=u('<div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">구매자 지불</span> <span class="font-medium text-gray-900"> </span></div> <!> <div class="flex justify-between"><span class="text-gray-600">플랫폼 수수료 (5%)</span> <span class="text-gray-400"> </span></div> <div class="flex justify-between border-t border-gray-200 pt-3 text-base"><span class="font-semibold text-gray-900">정산 금액</span> <span class="text-primary text-2xl font-bold"> </span></div></div>'),_e=u('<div class="flex justify-between"><span class="text-gray-600">원래 금액</span> <span class="font-medium text-gray-900"> </span></div> <div class="flex justify-between"><span class="text-gray-600">쿠폰 할인</span> <span class="font-medium text-blue-600"> </span></div> <div class="flex justify-between border-t border-gray-200 pt-3 text-base"><span class="font-semibold text-gray-900">최종 결제 금액</span> <span class="text-primary text-2xl font-bold"> </span></div>',1),pe=u('<div class="flex items-baseline justify-between"><span class="text-sm text-gray-600">결제 금액</span> <span class="text-primary text-2xl font-bold"> </span></div>'),me=u('<div class="space-y-2 text-sm"><!></div>'),ue=u('<div class="flex justify-between text-sm"><span class="text-gray-700"> </span> <span class="text-gray-700"> </span></div>'),be=u('<div class="mt-3 border-t border-gray-100 pt-3"><p class="mb-2 text-xs font-semibold text-gray-600">선택된 옵션</p> <!></div>'),xe=u('<div class="flex justify-between"><span class="text-gray-600">연락처</span> <span class="font-medium text-gray-900"> </span></div>'),fe=u('<div class="mb-6 rounded-xl border border-gray-200 bg-white p-5"><h3 class="mb-2 text-sm font-semibold text-gray-900"> </h3> <p class="text-sm text-gray-700"> </p></div>'),ye=u('<button class="btn-primary btn flex-1 rounded-lg px-4 py-3 text-sm font-semibold">결제 승인</button> <button class="btn-gray btn rounded-lg px-4 py-3 text-sm font-semibold">취소</button>',1),ge=u('<button class="btn-primary btn flex-1 rounded-lg px-4 py-3 text-sm font-semibold">서비스 완료</button> <button class="btn-gray btn rounded-lg px-4 py-3 text-sm font-semibold">취소</button>',1),he=(L,b)=>at(`/service/${b.service_id}`),we=u('<button class="flex-1 rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm font-semibold text-gray-700 hover:bg-gray-50">서비스 보기</button>'),$e=(L,b)=>at(`/service/${b.service_id}`),ke=u('<button class="btn btn-outline btn-error rounded-lg px-4 py-3 text-sm font-semibold">주문 취소</button>'),je=(L,b)=>at(`/service/${b.service_id}#reviews`),Se=u('<button class="btn-primary btn flex-1 rounded-lg px-4 py-3 text-sm font-semibold">리뷰 작성</button>'),qe=u('<button class="btn-gray btn flex-1 rounded-lg px-4 py-3 text-sm font-semibold">서비스 보기</button> <!> <!>',1),Fe=u('<!> <main class="mx-4 pb-24"><div class="mt-4 mb-4"><span> </span></div> <div class="mb-6"><h2 class="mb-2 text-2xl font-bold text-gray-900"> </h2> <p class="text-sm text-gray-500"><!></p> <p class="text-sm text-gray-500"> </p></div> <div class="mb-6 rounded-xl border border-gray-200 bg-white p-5"><h3 class="mb-4 text-base font-semibold text-gray-900">금액 정보</h3> <!></div> <div class="mb-6 rounded-xl border border-gray-200 bg-white p-5"><h3 class="mb-4 text-base font-semibold text-gray-900">주문 상세</h3> <div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">서비스 단가</span> <span class="font-medium text-gray-900"> </span></div> <div class="flex justify-between"><span class="text-gray-600">수량</span> <span class="font-medium text-gray-900"> </span></div> <!></div></div> <div class="mb-6 rounded-xl border border-gray-200 bg-white p-5"><h3 class="mb-4 text-base font-semibold text-gray-900">입금 정보</h3> <div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-gray-600">입금자명</span> <span class="font-medium text-gray-900"> </span></div> <div class="flex justify-between"><span class="text-gray-600">은행</span> <span class="font-medium text-gray-900"> </span></div> <div class="flex justify-between"><span class="text-gray-600">계좌번호</span> <span class="font-medium text-gray-900"> </span></div> <!></div></div> <!></main> <div class="fixed bottom-0 w-full max-w-screen-md border-gray-200 bg-white px-4 py-3"><div class="pb-safe flex gap-2"><!></div></div>',1);function Me(L,b){Ot(b,!0);const i=ee(),g=ae();let{order:w,order_options:z,is_buyer:j,is_seller:B}=b.data,r=K(w),st=K(z),A=K(j),C=K(B);const ft=a=>({pending:"결제 대기",paid:"결제 완료",completed:"서비스 완료",cancelled:"주문 취소",refunded:"환불 완료"})[a]||a,yt=a=>({pending:"bg-yellow-100 text-yellow-800",paid:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800"})[a]||"bg-gray-100 text-gray-800",gt=a=>new Date(a).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});var rt=Fe();Yt(a=>{Tt.title="주문 상세 | 문"});var ot=D(rt);re(ot,{$$slots:{left:(a,o)=>{var n=le();n.__click=[ne];var p=t(n);se(p,{size:24,get color(){return te.gray[600]}}),e(n),v(a,n)},center:(a,o)=>{var n=ce();v(a,n)}}});var E=s(ot,2),G=t(E),I=t(G),ht=t(I,!0);e(I),e(G);var J=s(G,2),M=t(J),wt=t(M,!0);e(M);var N=s(M,2),$t=t(N);{var kt=a=>{var o=bt();$(()=>d(o,`판매자: @${r.seller.handle??""}`)),v(a,o)},jt=a=>{var o=bt();$(()=>d(o,`구매자: @${r.buyer.handle??""}`)),v(a,o)};h($t,a=>{A?a(kt):a(jt,!1)})}e(N);var it=s(N,2),St=t(it,!0);e(it),e(J);var O=s(J,2),qt=s(t(O),2);{var Ft=a=>{var o=ve(),n=t(o),p=s(t(n),2),y=t(p);e(p),e(n);var c=s(n,2);{var m=q=>{var F=de(),R=s(t(F),2),Z=t(R);e(R),e(F),$(tt=>d(Z,`+₩${tt??""}`),[()=>k(r.coupon_discount)]),v(q,F)};h(c,q=>{r.coupon_discount&&r.coupon_discount>0&&q(m)})}var l=s(c,2),_=s(t(l),2),x=t(_);e(_),e(l);var f=s(l,2),S=s(t(f),2),P=t(S);e(S),e(f),e(o),$((q,F,R)=>{d(y,`₩${q??""}`),d(x,`-₩${F??""}`),d(P,`₩${R??""}`)},[()=>k(r.total_with_commission),()=>k(r.commission_amount),()=>k(r.total_with_commission+(r.coupon_discount||0)-r.commission_amount)]),v(a,o)},Lt=a=>{var o=me(),n=t(o);{var p=c=>{var m=_e(),l=D(m),_=s(t(l),2),x=t(_);e(_),e(l);var f=s(l,2),S=s(t(f),2),P=t(S);e(S),e(f);var q=s(f,2),F=s(t(q),2),R=t(F);e(F),e(q),$((Z,tt,Nt)=>{d(x,`₩${Z??""}`),d(P,`-₩${tt??""}`),d(R,`₩${Nt??""}`)},[()=>k(r.total_with_commission+r.coupon_discount),()=>k(r.coupon_discount),()=>k(r.total_with_commission)]),v(c,m)},y=c=>{var m=pe(),l=s(t(m),2),_=t(l);e(l),e(m),$(x=>d(_,`₩${x??""}`),[()=>k(r.total_with_commission)]),v(c,m)};h(n,c=>{r.coupon_discount&&r.coupon_discount>0?c(p):c(y,!1)})}e(o),v(a,o)};h(qt,a=>{C?a(Ft):a(Lt,!1)})}e(O);var Q=s(O,2),nt=s(t(Q),2),T=t(nt),lt=s(t(T),2),Rt=t(lt);e(lt),e(T);var U=s(T,2),ct=s(t(U),2),Dt=t(ct);e(ct),e(U);var Ht=s(U,2);{var Pt=a=>{var o=be(),n=s(t(o),2);Vt(n,17,()=>st,Wt,(p,y)=>{var c=ue(),m=t(c),l=t(m);e(m);var _=s(m,2),x=t(_);e(_),e(c),$(f=>{d(l,`· ${xt(y).option_name??""}`),d(x,`+₩${f??""}`)},[()=>k(xt(y).option_price)]),v(p,c)}),e(o),v(a,o)};h(Ht,a=>{st.length>0&&a(Pt)})}e(nt),e(Q);var V=s(Q,2),dt=s(t(V),2),W=t(dt),vt=s(t(W),2),zt=t(vt,!0);e(vt),e(W);var X=s(W,2),_t=s(t(X),2),At=t(_t,!0);e(_t),e(X);var Y=s(X,2),pt=s(t(Y),2),Kt=t(pt,!0);e(pt),e(Y);var Bt=s(Y,2);{var Ct=a=>{var o=xe(),n=s(t(o),2),p=t(n,!0);e(n),e(o),$(()=>d(p,r.buyer_contact)),v(a,o)};h(Bt,a=>{r.buyer_contact&&a(Ct)})}e(dt),e(V);var Et=s(V,2);{var Gt=a=>{var o=fe(),n=t(o),p=t(n,!0);e(n);var y=s(n,2),c=t(y,!0);e(y),e(o),$(()=>{d(p,C?"구매자 요청사항":"요청사항"),d(c,r.special_request)}),v(a,o)};h(Et,a=>{r.special_request&&a(Gt)})}e(E);var mt=s(E,2),ut=t(mt),It=t(ut);{var Jt=a=>{var o=Ut(),n=D(o);{var p=c=>{var m=ye(),l=D(m);l.__click=[oe,g,r,i];var _=s(l,2);_.__click=[et,g,r,A,i],v(c,m)},y=(c,m)=>{{var l=x=>{var f=ge(),S=D(f);S.__click=[ie,g,r,i];var P=s(S,2);P.__click=[et,g,r,A,i],v(x,f)},_=x=>{var f=we();f.__click=[he,r],v(x,f)};h(c,x=>{r.status==="paid"?x(l):x(_,!1)},m)}};h(n,c=>{r.status==="pending"?c(p):c(y,!1)})}v(a,o)},Mt=a=>{var o=qe(),n=D(o);n.__click=[$e,r];var p=s(n,2);{var y=l=>{var _=ke();_.__click=[et,g,r,A,i],v(l,_)};h(p,l=>{r.status==="pending"&&l(y)})}var c=s(p,2);{var m=l=>{var _=Se();_.__click=[je,r],v(l,_)};h(c,l=>{r.status==="completed"&&l(m)})}v(a,o)};h(It,a=>{C?a(Jt):a(Mt,!1)})}e(ut),e(mt),$((a,o,n,p)=>{Zt(I,1,`inline-block rounded-full px-3 py-1 text-sm font-semibold ${a??""}`),d(ht,o),d(wt,r.service_title),d(St,n),d(Rt,`₩${p??""}`),d(Dt,`${r.quantity??""}개`),d(zt,r.depositor_name),d(At,r.bank),d(Kt,r.account_number)},[()=>yt(r.status),()=>ft(r.status),()=>gt(r.created_at),()=>k(r.unit_price)]),v(L,rt),Qt()}Xt(["click"]);export{Me as component};
