import"../chunks/CWj6FrbW.js";import{i as Q,t as w,m,l as r,r as i,v as nt,g as h,k as W,u as M,n as a,z as ct,o as Z,f as rt,j as dt,ac as ut,s as Y,x as E,$ as vt}from"../chunks/BxrbYPPH.js";import{s as U}from"../chunks/BpDpeONt.js";import{i as I}from"../chunks/C_-0o-f2.js";import{d as F,r as mt,h as _t}from"../chunks/DKpueC4a.js";import{a as tt,r as et,b as pt,c as ft}from"../chunks/BGk8CD_Q.js";import{t as at}from"../chunks/Dk6PeW0B.js";import{P as it}from"../chunks/bafqjiaL.js";import{g as K}from"../chunks/CCryTnhq.js";import"../chunks/69_IOA4Y.js";import{R as gt}from"../chunks/DgJjuvVc.js";import{H as bt}from"../chunks/CATT0rBV.js";import{M as xt}from"../chunks/IkWuq9-R.js";import{c as yt}from"../chunks/Dcrl4MPd.js";import{u as st,s as N}from"../chunks/iREZRceN.js";import{g as ht,a as wt}from"../chunks/C6eE29Wt.js";import{i as $t}from"../chunks/Bb3yvuEN.js";import{p as z}from"../chunks/Cqu1rs7T.js";import{l as kt}from"../chunks/CsDvq0KH.js";import"../chunks/Pd2d67t4.js";import{b as q}from"../chunks/vV7d1D-f.js";import{e as G,i as J}from"../chunks/n-s4RcA1.js";var Ct=w('<img alt="커뮤니티 프로필 사진" loading="eager" width="96" height="96">'),Lt=w('<img alt="기본 커뮤니티 프로필 사진" loading="eager" width="96" height="96">'),Ht=w('<div class="mx-4 mt-8"><p class="ml-1 font-semibold">커뮤니티 프로필 사진 추가 (선택)</p> <div class="mt-10 flex justify-center"><div class="flex items-center justify-center"><label for="input-file"><input type="file" id="input-file" accept="image/*" class="hidden"> <div class="avatar relative"><div class="w-24 rounded-full"><!></div> <svg class="absolute right-0 bottom-0" width="28" height="29" viewBox="0 0 30 31" fill="none" xmlns="http://www.w3.org/2000/svg"><rect y="0.808594" width="30" height="30" rx="15" fill="#237BF8"></rect><path d="M16.484 11.1419L17.765 12.4753H20.6V20.4753H9.4V12.4753H12.235L13.516 11.1419H16.484ZM17.1 9.80859H12.9L11.619 11.1419H9.4C8.63 11.1419 8 11.7419 8 12.4753V20.4753C8 21.2086 8.63 21.8086 9.4 21.8086H20.6C21.37 21.8086 22 21.2086 22 20.4753V12.4753C22 11.7419 21.37 11.1419 20.6 11.1419H18.381L17.1 9.80859ZM15 14.4753C16.155 14.4753 17.1 15.3753 17.1 16.4753C17.1 17.5753 16.155 18.4753 15 18.4753C13.845 18.4753 12.9 17.5753 12.9 16.4753C12.9 15.3753 13.845 14.4753 15 14.4753ZM15 13.1419C13.068 13.1419 11.5 14.6353 11.5 16.4753C11.5 18.3153 13.068 19.8086 15 19.8086C16.932 19.8086 18.5 18.3153 18.5 16.4753C18.5 14.6353 16.932 13.1419 15 13.1419Z" fill="white"></path></svg></div></label></div></div></div>');function jt(x,e){Q(e,!1);let o=z(e,"avatar_url",12);const c=async l=>{const v=l.target.files[0];v.uri=URL.createObjectURL(v),o(v)};$t();var $=Ht(),p=m(r($),2),d=r(p),L=r(d),_=r(L);_.__change=c;var y=m(_,2),t=r(y),b=r(t);{var u=l=>{var v=Ct();M(()=>tt(v,"src",o().uri??o())),h(l,v)},f=l=>{var v=Lt();tt(v,"src",kt),h(l,v)};I(b,l=>{o()?l(u):l(f,!1)})}i(t),nt(2),i(y),i(L),i(d),i(p),i($),h(x,$),W()}F(["change"]);var St=(x,e,o)=>e(o()),Mt=w('<p class="mt-1 text-sm text-red-500">커뮤니티 url 주소에는 영문, 숫자, 하이픈만 사용할 수 있습니다.</p>'),Pt=w('<section class="mx-4"><div class="mt-4"><p class="ml-1 text-sm font-semibold">커뮤니티 제목</p> <div class="mt-2"><input type="text" placeholder="커뮤니티 제목을 입력해주세요." class="input input-bordered focus:border-primary h-[52px] w-full focus:outline-none"></div></div> <div class="mt-4"><p class="ml-1 text-sm font-semibold">커뮤니티 url 주소</p> <div class="mt-2"><input type="text" placeholder="(영문, 숫자, 하이픈만 사용 가능) 예시: chatgpt-study" class="input input-bordered focus:border-primary h-[52px] w-full focus:outline-none"></div></div> <!> <div class="mt-6 flex flex-col"><p class="ml-1 text-sm font-semibold">커뮤니티 내용</p> <div class="mt-2"><textarea type="text" class="textarea input input-bordered focus:border-primary h-40 w-full focus:outline-none" placeholder="커뮤니티에 대한 상세한 설명을 입력해주세요."></textarea></div></div></section>');function At(x,e){let o=z(e,"title",12),c=z(e,"content",12),$=z(e,"slug",12),p=z(e,"is_edit_mode",8),d=ct(!1),L=H=>{/^[a-zA-Z0-9-]+$/.test(H)?Z(d,!1):Z(d,!0)};var _=Pt(),y=r(_),t=m(r(y),2),b=r(t);et(b),i(t),i(y);var u=m(y,2),f=m(r(u),2),l=r(f);et(l),l.__input=[St,L,$],i(f),i(u);var v=m(u,2);{var P=H=>{var B=Mt();h(H,B)};I(v,H=>{a(d)&&H(P)})}var A=m(v,2),R=m(r(A),2),k=r(R);mt(k),i(R),i(A),i(_),M(()=>l.disabled=p()),q(b,o),q(l,$),q(k,c),h(x,_)}F(["input"]);var Rt=(x,e,o)=>e(a(o)),Ut=w('<div class="flex items-center rounded-full bg-gray-200 px-3 py-1 text-sm"> <button class="ml-2 text-gray-500">✕</button></div>'),Zt=(x,e,o)=>e(a(o)),Bt=w("<button> </button>"),Vt=w('<div><p class="mb-2 font-semibold"> </p> <div class="flex flex-wrap gap-2"></div></div>'),zt=w('<section class="mx-4"><div class="mt-10 text-xl font-semibold"><p>커뮤니티 주제를 알려주세요</p></div> <div class="mt-6"><p class="text-sm"> </p></div> <div class="mt-2 flex flex-wrap gap-2"></div></section> <section class="mx-4 mt-6 space-y-6"></section>',1);function It(x,e){Q(e,!0);const o=b=>e.selected_topics.some(u=>u.id===b.id),c=b=>{const u=e.selected_topics.findIndex(f=>f.id===b.id);u>-1?e.selected_topics.splice(u,1):e.selected_topics.length<3&&e.selected_topics.push(b)};var $=zt(),p=rt($),d=m(r(p),2),L=r(d),_=r(L);i(L),i(d);var y=m(d,2);G(y,21,()=>e.selected_topics,J,(b,u)=>{var f=Ut(),l=r(f),v=m(l);v.__click=[Rt,c,u],i(f),M(()=>U(l,`${a(u).name??""} `)),h(b,f)}),i(y),i(p);var t=m(p,2);G(t,21,()=>e.topic_categories,J,(b,u)=>{var f=Vt(),l=r(f),v=r(l);i(l);var P=m(l,2);G(P,21,()=>a(u).topics,J,(A,R)=>{var k=Bt();k.__click=[Zt,c,R];var H=r(k,!0);i(k),M(B=>{pt(k,1,`rounded-full px-3 py-1 text-sm transition
              ${B??""}`),U(H,a(R).name)},[()=>o(a(R))?"bg-gray-800 text-white":"bg-gray-100 hover:bg-gray-200"]),h(A,k)}),i(P),i(f),M(()=>U(v,`${a(u).emoji??""} ${a(u).name??""}`)),h(b,f)}),i(t),M(()=>U(_,`커뮤니티 주제 ${e.selected_topics.length??""}/3`)),h(x,$),W()}F(["click"]);const Tt=(x,e,o)=>{a(e)===1?Z(o,!0):Z(e,a(e)-1)},Dt=async(x,e,o,c)=>{if(a(e)===2){if(await o()){N("error","이미 사용중인 슬러그입니다.");return}}else if(a(e)===3){await c();return}Z(e,a(e)+1)};var Et=w('<meta name="description" content="커뮤니티를 생성할 수 있는 문의 커뮤니티 생성 페이지입니다.">'),Ft=w('<button slot="left" class="flex items-center"><!></button>'),Ot=w('<h1 slot="center" class=" font-semibold"> </h1>'),qt=(x,e)=>Z(e,!1),Gt=(x,e,o)=>{K(a(e)?`/community/${o.slug}`:"/community")},Jt=w('<div><div class="flex flex-col items-center justify-center py-10 font-semibold"><p> </p></div> <div class="flex"><button class="btn w-1/3 rounded-none">닫기</button> <button class="btn btn-error w-2/3 rounded-none text-white">다음에 할게요</button></div></div>'),Kt=w('<!> <main><div class="h-1 w-full rounded-full bg-gray-200 dark:bg-gray-300"><div class="bg-primary h-1 rounded-full"></div></div> <!> <div class="fixed bottom-0 w-full max-w-screen-md bg-white p-4"><button class="btn btn-primary w-full"> </button></div></main> <!>',1);function ge(x,e){Q(e,!0);const o=ht(),c=wt();let $=E(()=>{let{topic_categories:s,community:g}=e.data;return s}),p=E(()=>{let{topic_categories:s,community:g}=e.data;return g}),d=E(()=>a(p)!=null),L=E(()=>a(d)?"커뮤니티 수정":"커뮤니티 생성"),_=Y(1),y=Y(!1),t=dt({id:null,title:"",slug:"",content:"",avatar_url:"",selected_topics:[]});ut(()=>{a(d)?(t.id=a(p).id,t.title=a(p).title,t.slug=a(p).slug,t.content=a(p).content,t.avatar_url=a(p).avatar_url,t.selected_topics=a(p).community_topics.map(s=>s.topics)):(t.id=null,t.title="",t.slug="",t.content="",t.avatar_url="",t.selected_topics=[])});const b=()=>{switch(a(_)){case 1:return t.selected_topics.length===0;case 2:return t.title===""||t.slug===""||t.content==="";default:return!1}},u=async()=>{st("loading",!0);try{if(a(d)){if(await c.communities.update(t.id,{title:t.title,slug:t.slug,content:t.content}),await c.community_topics.delete_by_community_id(t.id),await c.community_topics.insert(t.id,t.selected_topics),typeof t.avatar_url=="object"&&t.avatar_url!==null){const s=t.avatar_url.name.split(".").pop(),g=`${t.id}/${Date.now()}.${s}`;await c.community_avatars.upload(g,t.avatar_url);const n=`${it}/storage/v1/object/public/communities/avatars/${g}`;await c.communities.update(t.id,{avatar_url:n})}N("success","커뮤니티 수정이 완료되었어요!"),K(`/community/${t.slug}`)}else{const s=await c.communities.insert({creator_id:o.id,title:t.title,slug:t.slug,content:t.content});if(await c.community_topics.insert(s.id,t.selected_topics),await c.community_members.insert(s.id,o.id),t.avatar_url){const g=t.avatar_url.name.split(".").pop(),n=`${s.id}/${Date.now()}.${g}`;await c.community_avatars.upload(n,t.avatar_url);const C=`${it}/storage/v1/object/public/communities/avatars/${n}`;await c.communities.update(s.id,{avatar_url:C})}N("success","커뮤니티 생성이 완료되었어요!"),K(`/community/${t.slug}`,{replaceState:!0})}}finally{st("loading",!1)}},f=async()=>a(d)?null:await c.communities.select_by_slug(t.slug);var l=Kt();_t(s=>{var g=Et();vt.title="커뮤니티 생성 | 문",h(s,g)});var v=rt(l);bt(v,{$$slots:{left:(s,g)=>{var n=Ft();n.__click=[Tt,_,y];var C=r(n);gt(C,{size:24,get color(){return yt.gray[600]}}),i(n),h(s,n)},center:(s,g)=>{var n=Ot(),C=r(n,!0);i(n),M(()=>U(C,a(L))),h(s,n)}}});var P=m(v,2),A=r(P),R=r(A);i(A);var k=m(A,2);{var H=s=>{It(s,{get topic_categories(){return a($)},get selected_topics(){return t.selected_topics},set selected_topics(g){t.selected_topics=g}})},B=(s,g)=>{{var n=j=>{At(j,{get is_edit_mode(){return a(d)},get title(){return t.title},set title(S){t.title=S},get slug(){return t.slug},set slug(S){t.slug=S},get content(){return t.content},set content(S){t.content=S}})},C=(j,S)=>{{var D=V=>{jt(V,{get avatar_url(){return t.avatar_url},set avatar_url(O){t.avatar_url=O}})};I(j,V=>{a(_)===3&&V(D)},S)}};I(s,j=>{a(_)===2?j(n):j(C,!1)},g)}};I(k,s=>{a(_)===1?s(H):s(B,!1)})}var X=m(k,2),T=r(X);T.__click=[Dt,_,f,u];var ot=r(T,!0);i(T),i(X),i(P);var lt=m(P,2);xt(lt,{modal_position:"center",get is_modal_open(){return a(y)},set is_modal_open(s){Z(y,s,!0)},children:(s,g)=>{var n=Jt(),C=r(n),j=r(C),S=r(j);i(j),i(C);var D=m(C,2),V=r(D);V.__click=[qt,y];var O=m(V,2);O.__click=[Gt,d,t],i(D),i(n),M(()=>U(S,`다음에 ${a(d)?"수정":"생성"} 하시겠어요?`)),at(1,n,()=>scale,()=>({duration:200,start:.95})),at(2,n,()=>fade,()=>({duration:150})),h(s,n)},$$slots:{default:!0}}),M(s=>{ft(R,`width: ${a(_)*(100/3)}%`),T.disabled=s,U(ot,a(_)===3?a(d)?"수정 완료":"커뮤니티 만들기":"다음")},[b]),h(x,l),W()}F(["click"]);export{ge as component};
