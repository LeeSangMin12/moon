import"../chunks/CWj6FrbW.js";import{o as J,s as ot}from"../chunks/BpDpeONt.js";import{s as z,j as G,n as i,o as n,q as Y,u as U,g as m,t as k,i as rt,f as q,l as x,k as st,$ as nt,r as C,m as I,e as Q}from"../chunks/BxrbYPPH.js";import{i as D}from"../chunks/C_-0o-f2.js";import{e as W,i as it}from"../chunks/n-s4RcA1.js";import{d as lt,h as dt}from"../chunks/DKpueC4a.js";import{s as $,a as ct}from"../chunks/BGk8CD_Q.js";import{P as ut,c as _t}from"../chunks/D_kLzBvZ.js";import{c as K}from"../chunks/Dcrl4MPd.js";import{g as mt,a as ft}from"../chunks/C6eE29Wt.js";import{c as vt}from"../chunks/iREZRceN.js";import{g as X}from"../chunks/CCryTnhq.js";import"../chunks/69_IOA4Y.js";import{R as gt}from"../chunks/CVQVGoVS.js";import{l as H,p as P}from"../chunks/Cqu1rs7T.js";import{B as ht}from"../chunks/CYBAZs4S.js";import{H as bt}from"../chunks/CATT0rBV.js";import{T as pt}from"../chunks/DEe1oh43.js";function yt(u,a,f=[]){let l=z(G(f)),d=z(G([])),h=z(G(["최신"])),t=z(0),w=z(0),v=z(""),g=z(!1),j=z(!1),p=null;async function O(){f.length>0&&f[0].hasOwnProperty("post_votes")&&f[0].hasOwnProperty("post_bookmarks")?n(l,f,!0):n(l,await F(f),!0),n(v,i(l)[i(l).length-1]?.id||"",!0)}async function L(){try{if(!a?.id)return;const e=await u.community_members.select_by_user_id(a.id);n(d,e.map(r=>r.communities),!0),n(h,["최신",...i(d).map(r=>r.title)],!0),await M()}catch(e){console.error("Failed to load secondary data:",e)}}async function M(){try{if(!a?.id)return;n(w,await u.notifications.select_unread_count(a.id),!0)}catch(e){console.error("Failed to load unread notifications count:",e)}}async function F(e){if(!a?.id||e.length===0)return e;try{const[r,y]=await Promise.all([u.post_votes.select_by_user_id(a.id),u.post_bookmarks.select_by_user_id_lightweight(a.id)]),N=new Set(e.map(s=>s.id)),o=r.filter(s=>N.has(s.post_id)),c=y.filter(s=>N.has(s.post_id));return e.map(s=>({...s,post_votes:o.filter(_=>_.post_id===s.id),post_bookmarks:c.filter(_=>_.post_id===s.id)}))}catch(r){return console.error("Failed to attach user interactions:",r),e}}async function R(e){if(!(!u?.posts||i(g))){n(g,!0);try{const r=e===0?"":i(d)[e-1]?.id??"",y=await u.posts.select_infinite_scroll("",r,10);n(l,await F(y),!0),n(v,y.at(-1)?.id??"",!0)}catch(r){console.error("Failed to load posts:",r)}finally{n(g,!1)}}}async function T(){if(!i(j))try{n(j,!0);const e=i(t)===0?"":i(d)[i(t)-1]?.id??"",r=await u.posts.select_infinite_scroll(i(v),e,10);if(r.length>0){const y=await F(r);n(l,[...i(l),...y],!0),n(v,r.at(-1)?.id??"",!0)}}catch(e){console.error("Failed to load more posts:",e)}finally{n(j,!1)}}function E(){p&&p.disconnect();const e=document.getElementById("infinite_scroll");return e?(p=new IntersectionObserver(r=>{r.forEach(y=>{y.isIntersecting&&!i(j)&&i(l).length>=10&&T()})},{rootMargin:"200px 0px",threshold:.01}),p.observe(e),()=>{p&&(p.disconnect(),p=null)}):(console.warn("Infinite scroll target not found"),()=>{})}function Z(e){n(l,e,!0)}return{get posts(){return i(l)},set posts(e){n(l,e,!0)},get joined_communities(){return i(d)},set joined_communities(e){n(d,e,!0),n(h,["최신",...e.map(r=>r.title)],!0)},get tabs(){return i(h)},set tabs(e){n(h,e,!0)},get selected(){return i(t)},set selected(e){n(t,e,!0)},get unread_count(){return i(w)},set unread_count(e){n(w,e,!0)},get is_tab_loading(){return i(g)},get is_infinite_loading(){return i(j)},initialize_posts:O,load_secondary_data:L,refresh_unread_count:M,load_posts_by_tab:R,load_more_data:T,setup_infinite_scroll:E,update_posts:Z}}var wt=Y('<svg><path d="M12 2C16.9706 2 21 6.04348 21 11.0314V20H3V11.0314C3 6.04348 7.02944 2 12 2ZM9.5 21H14.5C14.5 22.3807 13.3807 23.5 12 23.5C10.6193 23.5 9.5 22.3807 9.5 21Z"></path></svg>');function xt(u,a){const f=H(a,["children","$$slots","$$events","$$legacy"]),l=H(f,["size","color","label","class"]);let d=P(a,"size",8,"1em"),h=P(a,"color",8,"currentColor"),t=P(a,"label",8,""),w=P(a,"class",8,"");var v=wt();let g;U(()=>g=$(v,g,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:d(),height:d(),fill:h(),"aria-label":t()?t():void 0,"aria-hidden":t()?void 0:"true",role:t()?"img":void 0,class:`remixicon ri-notification-fill ${w()??""}`,...l})),m(u,v)}var Ct=Y('<svg><path d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"></path></svg>');function kt(u,a){const f=H(a,["children","$$slots","$$events","$$legacy"]),l=H(f,["size","color","label","class"]);let d=P(a,"size",8,"1em"),h=P(a,"color",8,"currentColor"),t=P(a,"label",8,""),w=P(a,"class",8,"");var v=Ct();let g;U(()=>g=$(v,g,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:d(),height:d(),fill:h(),"aria-label":t()?t():void 0,"aria-hidden":t()?void 0:"true",role:t()?"img":void 0,class:`remixicon ri-search-line ${w()??""}`,...l})),m(u,v)}var zt=k('<article class="px-4 animate-pulse"><div class="flex items-center justify-between"><div class="flex items-center"><div class="mr-2 h-8 w-8 rounded-full bg-gray-200"></div> <div class="h-4 w-24 bg-gray-200 rounded"></div></div></div> <div class="mt-3 h-5 w-3/4 bg-gray-200 rounded"></div> <div class="mt-2 space-y-2"><div class="h-4 w-full bg-gray-200 rounded"></div> <div class="h-4 w-5/6 bg-gray-200 rounded"></div></div> <div class="mt-2 h-48 w-full bg-gray-200 rounded-lg"></div> <div class="mt-3 flex gap-4"><div class="h-4 w-12 bg-gray-200 rounded"></div> <div class="h-4 w-12 bg-gray-200 rounded"></div> <div class="h-4 w-12 bg-gray-200 rounded"></div></div></article>');function Pt(u){var a=zt();m(u,a)}const jt=(u,a)=>{vt(a)&&X("/regi/post")},It=()=>{X("/search")},Ft=()=>{X("/alarm")};var At=k('<meta name="description" content="AI·마케팅·디자인·IT 등 다양한 분야의 전문가를 문에서 만나보세요.">'),Bt=k('<h1 slot="left" class="font-semibold"></h1>'),Lt=k('<span class="absolute -top-1 -right-1 rounded-full bg-red-500 px-1.5 py-0.5 text-[10px] leading-none text-white"> </span>'),Mt=k('<div slot="right" class="flex items-center gap-4"><button aria-label="검색"><!></button> <button class="relative" aria-label="알림"><!> <!></button></div>'),Ot=k('<div class="mt-4"><!></div>'),Tt=k('<div class="mt-4"><!></div>'),Et=k('<div class="flex justify-center py-4" role="status" aria-label="로딩 중"><div class="border-primary h-8 w-8 animate-spin rounded-full border-t-2 border-b-2"></div></div>'),Nt=k('<!> <main><!> <!> <div id="infinite_scroll" aria-hidden="true"></div> <!> <div class="fixed bottom-18 z-10 mx-auto flex w-full max-w-screen-md justify-end pr-4"><button class="rounded-full bg-blue-500 p-4 text-white shadow-lg hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none" aria-label="게시물 작성"><!></button></div></main> <!>',1);function ae(u,a){rt(a,!0);const f=5,l=99,d=mt(),h=ft(),t=yt(h,d,a.data.posts||[]);J(async()=>{t.initialize_posts(),a.data.communities instanceof Promise?a.data.communities.then(o=>{t.joined_communities=o,t.tabs=["최신",...o.map(c=>c.title)]}):a.data.communities&&(t.joined_communities=a.data.communities,t.tabs=["최신",...a.data.communities.map(o=>o.title)]),a.data.unread_count instanceof Promise?a.data.unread_count.then(o=>{t.unread_count=o}):a.data.unread_count!==void 0&&(t.unread_count=a.data.unread_count)}),J(()=>t.setup_infinite_scroll());const w=o=>{o>0&&t.joined_communities.length===0||t.load_posts_by_tab(o)},v=async({gift_content:o,gift_moon_point:c,parent_comment_id:s,post_id:_})=>{try{await h.post_comments.insert({post_id:_,user_id:d.id,content:o,parent_comment_id:s,gift_moon_point:c})}catch(A){console.error("Failed to add gift comment:",A)}},{handle_bookmark_changed:g,handle_vote_changed:j}=_t(()=>t.posts,o=>t.update_posts(o),d);var p=Nt();dt(o=>{var c=At();nt.title="전문가 매칭의 모든것, 문",m(o,c)});var O=q(p);bt(O,{$$slots:{left:(o,c)=>{var s=Bt();s.textContent="문",m(o,s)},right:(o,c)=>{var s=Mt(),_=x(s);_.__click=[It];var A=x(_);kt(A,{size:20,get color(){return K.gray[400]}}),C(_);var b=I(_,2);b.__click=[Ft];var B=x(b);xt(B,{size:20,get color(){return K.gray[400]}});var tt=I(B,2);{var et=V=>{var S=Lt(),at=x(S,!0);C(S),U(()=>{ct(S,"aria-label",`읽지 않은 알림 ${t.unread_count}개`),ot(at,t.unread_count>l?`${l}+`:t.unread_count)}),m(V,S)};D(tt,V=>{t.unread_count>0&&V(et)})}C(b),C(s),m(o,s)}}});var L=I(O,2),M=x(L);pt(M,{get tabs(){return t.tabs},on_change:w,get selected(){return t.selected},set selected(o){t.selected=o}});var F=I(M,2);{var R=o=>{var c=Q(),s=q(c);W(s,17,()=>Array(f),it,(_,A)=>{var b=Ot(),B=x(b);Pt(B),C(b),m(_,b)}),m(o,c)},T=o=>{var c=Q(),s=q(c);W(s,17,()=>t.posts,_=>_.id,(_,A)=>{var b=Tt(),B=x(b);ut(B,{get post(){return i(A)},onGiftCommentAdded:v,onBookmarkChanged:g,onVoteChanged:j}),C(b),m(_,b)}),m(o,c)};D(F,o=>{t.is_tab_loading||t.posts.length===0?o(R):o(T,!1)})}var E=I(F,4);{var Z=o=>{var c=Et();m(o,c)};D(E,o=>{t.is_infinite_loading&&o(Z)})}var e=I(E,2),r=x(e);r.__click=[jt,d];var y=x(r);gt(y,{size:20,get color(){return K.white}}),C(r),C(e),C(L);var N=I(L,2);ht(N,{}),m(u,p),st()}lt(["click"]);export{ae as component};
