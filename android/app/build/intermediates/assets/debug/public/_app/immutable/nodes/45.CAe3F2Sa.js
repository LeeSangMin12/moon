import"../chunks/CWj6FrbW.js";import{i as oe,t as b,f as O,l as c,m as g,r as s,n as r,x as ae,v as be,u as Z,g as d,k as ne,j as he,s as re,$ as ge,o as ie,e as se}from"../chunks/BxrbYPPH.js";import{d as ce,h as pe}from"../chunks/DKpueC4a.js";import{i as L}from"../chunks/C_-0o-f2.js";import{e as K,i as N}from"../chunks/n-s4RcA1.js";import{a as G,r as ke}from"../chunks/BGk8CD_Q.js";import{b as xe}from"../chunks/vV7d1D-f.js";import{P as we,c as Ce}from"../chunks/Dlgnc5bw.js";import{c as ee}from"../chunks/Dcrl4MPd.js";import{g as me,a as le}from"../chunks/C6eE29Wt.js";import"../chunks/BnrzeG8w.js";import"../chunks/ixumTwwY.js";import{I as te}from"../chunks/BtboDQMP.js";import{T as je}from"../chunks/DEe1oh43.js";import{s as $}from"../chunks/BpDpeONt.js";import{p as ze}from"../chunks/Cqu1rs7T.js";import{l as Se}from"../chunks/CsDvq0KH.js";import{s as Q,c as Fe}from"../chunks/iREZRceN.js";import{U as Pe}from"../chunks/CZSApgyP.js";import{S as Ie}from"../chunks/rGeCVgF5.js";const Me=async(p,t,n,i,o)=>{if(Fe(t))try{await n.community_members.insert(i.community.id,t.id),o().push({community_id:i.community.id,user_id:t.id}),Q("success","커뮤니티에 참여했어요!"),i.onMembershipChanged?.({community_id:i.community.id,members:o()})}catch(e){console.error("Failed to join community:",e),Q("error","참여에 실패했어요. 다시 시도해주세요.")}},Te=async(p,t,n,i,o)=>{try{await t.community_members.delete(n.community.id,i.id),o(o().filter(e=>e.community_id!==n.community.id)),Q("error","커뮤니티 참여가 취소되었어요!"),n.onMembershipChanged?.({community_id:n.community.id,members:o()})}catch(e){console.error("Failed to leave community:",e),Q("error","탈퇴에 실패했어요. 다시 시도해주세요.")}};var Ue=b('<button class="btn btn-sm btn-soft h-7">참여중</button>'),Ae=b('<button class="btn btn-primary btn-sm h-7">참여하기</button>'),Be=b('<article class="px-4"><div class="flex items-start justify-between"><a class="flex"><img class="mr-2 h-12 w-12 rounded-full object-cover" loading="lazy" decoding="async"> <div class="flex flex-col justify-between"><p class="line-clamp-2 pr-4 font-medium"> </p> <p class="flex text-xs text-gray-400"><!> </p></div></a> <!></div> <p class="mt-2 line-clamp-2 text-sm text-gray-800"> </p></article> <hr class="my-3 border-gray-200">',1);function Ee(p,t){oe(t,!0);const n=me(),i=le();let o=ze(t,"community_members",23,()=>[]);const e=ae(()=>t.community.community_members?.[0]?.count??0),R=ae(()=>o().some(v=>v.community_id===t.community.id));var _=Be(),V=O(_),w=c(V),S=c(w),M=c(S),q=g(M,2),T=c(q),D=c(T,!0);s(T);var F=g(T,2),U=c(F);te(U,{attribute:"person",size:16,get color(){return ee.gray[400]}});var H=g(U);s(F),s(q),s(S);var P=g(S,2);{var W=v=>{var u=Ue();u.__click=[Te,i,t,n,o],Z(()=>G(u,"aria-label",`${t.community.title} 커뮤니티 탈퇴`)),d(v,u)},J=v=>{var u=Ae();u.__click=[Me,n,i,t,o],Z(()=>G(u,"aria-label",`${t.community.title} 커뮤니티 참여하기`)),d(v,u)};L(P,v=>{r(R)?v(W):v(J,!1)})}s(w);var C=g(w,2),A=c(C,!0);s(C),s(V),be(2),Z(()=>{G(S,"href",`/community/${t.community.slug}`),G(M,"src",t.community.avatar_url||Se),G(M,"alt",`${t.community.title} 커뮤니티`),$(D,t.community.title),$(H,` ${r(e)??""}`),$(A,t.community.content)}),d(p,_),ne()}ce(["click"]);var Ge=b('<meta name="description" content="게시글, 커뮤니티, 서비스, 프로필을 검색하여 원하는 정보와 전문가를 찾아보세요.">'),Le=()=>window.history.back(),Ve=async(p,t)=>{p.key==="Enter"&&await t()},qe=async(p,t)=>{await t()},De=b('<div class="mt-4"><!></div>'),He=b('<div class="mt-4"><!></div>'),Je=b('<div class="mt-4 grid grid-cols-2 gap-4 px-4"></div>'),Ke=b('<div class="mt-4"></div>'),Ne=b('<div class="mt-12 flex h-full items-center justify-center"><p class="text-gray-400">검색 결과가 없습니다.</p></div>'),Oe=b('<header class="sticky top-0 z-50 bg-white whitespace-nowrap"><nav class="pt-safe"><div class="z-10 flex h-[56px] w-full items-center gap-2 px-2"><button><!></button> <div class="relative w-full"><input type="text" placeholder="검색어를 입력하세요" class="block w-full rounded-lg bg-gray-100 p-2.5 text-sm focus:outline-none"> <button class="absolute inset-y-0 right-1 flex items-center pr-3"><!></button></div></div></nav></header> <main><div class="mt-4"><!></div> <!></main>',1);function vt(p,t){oe(t,!0);const n=me(),i=le();let o=re(""),e=he({posts:[],communities:[],community_members:[],services:[],service_likes:[],profiles:[]}),R=["게시글","커뮤니티","서비스","프로필"],_=re(0);const V=async a=>{if(!n?.id||a.length===0)return a;try{const[l,j]=await Promise.all([i.post_votes.select_by_user_id(n.id),i.post_bookmarks.select_by_user_id_lightweight(n.id)]),k=new Set(a.map(m=>m.id)),f=l.filter(m=>k.has(m.post_id)),y=j.filter(m=>k.has(m.post_id));return a.map(m=>({...m,post_votes:f.filter(z=>z.post_id===m.id),post_bookmarks:y.filter(z=>z.post_id===m.id)}))}catch(l){return console.error("Failed to attach user interactions:",l),a}},w=async()=>{if(r(o)!=="")if(r(_)===0){const a=await i.posts.select_by_search(r(o));e.posts=await V(a)}else r(_)===1?(e.communities=await i.communities.select_by_search(r(o)),e.community_members=await i.community_members.select_by_user_id(n.id)):r(_)===2?(e.services=await i.services.select_by_search(r(o)),e.service_likes=await i.service_likes.select_by_user_id(n.id)):r(_)===3&&(e.profiles=await i.users.select_by_search(r(o)))},S=async({gift_content:a,gift_moon_point:l,parent_comment_id:j,post_id:k})=>{await i.post_comments.insert({post_id:k,user_id:n.id,content:a,parent_comment_id:j,gift_moon_point:l})},{handle_bookmark_changed:M,handle_vote_changed:q}=Ce(()=>e.posts,a=>{e.posts=a},n),T=({service_id:a,likes:l})=>{e.service_likes=l};var D=Oe();pe(a=>{var l=Ge();ge.title="검색 | 문",d(a,l)});var F=O(D),U=c(F),H=c(U),P=c(H);P.__click=[Le];var W=c(P);te(W,{attribute:"arrow_left",size:28,get color(){return ee.gray[600]}}),s(P);var J=g(P,2),C=c(J);ke(C),C.__keydown=[Ve,w];var A=g(C,2);A.__click=[qe,w];var v=c(A);te(v,{attribute:"search",size:24,get color(){return ee.gray[500]}}),s(A),s(J),s(H),s(U),s(F);var u=g(F,2),X=c(u),_e=c(X);je(_e,{tabs:R,on_change:w,get selected(){return r(_)},set selected(a){ie(_,a,!0)}}),s(X);var de=g(X,2);{var ve=a=>{var l=se(),j=O(l);K(j,17,()=>e.posts,N,(k,f)=>{var y=De(),m=c(y);we(m,{get post(){return r(f)},onGiftCommentAdded:S,onBookmarkChanged:M,onVoteChanged:q}),s(y),d(k,y)}),d(a,l)},ue=(a,l)=>{{var j=f=>{var y=se(),m=O(y);K(m,17,()=>e.communities,N,(z,x)=>{var h=He(),B=c(h);Ee(B,{get community(){return r(x)},get community_members(){return e.community_members}}),s(h),d(z,h)}),d(f,y)},k=(f,y)=>{{var m=x=>{var h=Je();K(h,21,()=>e.services,N,(B,Y)=>{Ie(B,{get service(){return r(Y)},get service_likes(){return e.service_likes},onLikeChanged:T})}),s(h),d(x,h)},z=(x,h)=>{{var B=I=>{var E=Ke();K(E,21,()=>e.profiles,N,(fe,ye)=>{Pe(fe,{get profile(){return r(ye)}})}),s(E),d(I,E)},Y=I=>{var E=Ne();d(I,E)};L(x,I=>{r(_)===3&&e.profiles.length>0?I(B):I(Y,!1)},h)}};L(f,x=>{r(_)===2&&e.services.length>0?x(m):x(z,!1)},y)}};L(a,f=>{r(_)===1&&e.communities.length>0?f(j):f(k,!1)},l)}};L(de,a=>{r(_)===0&&e.posts.length>0?a(ve):a(ue,!1)})}s(u),xe(C,()=>r(o),a=>ie(o,a)),d(p,D),ne()}ce(["click","keydown"]);export{vt as component};
