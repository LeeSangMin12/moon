import"../chunks/CWj6FrbW.js";import{i as bt,j as V,t as w,f as yt,l as e,m as o,u as lt,g as h,k as wt,$ as $t,r as t,n as _}from"../chunks/BxrbYPPH.js";import{s as Lt}from"../chunks/BpDpeONt.js";import{e as dt,i as ct}from"../chunks/n-s4RcA1.js";import{d as Ct,h as kt}from"../chunks/DKpueC4a.js";import{r as b,a as C}from"../chunks/BGk8CD_Q.js";import{b as y}from"../chunks/vV7d1D-f.js";import{P as Ht}from"../chunks/bafqjiaL.js";import{s as Rt}from"../chunks/BqNaFByK.js";import{g as jt}from"../chunks/DOeRUQ82.js";import"../chunks/69_IOA4Y.js";import{R as St}from"../chunks/DgJjuvVc.js";import{H as Tt}from"../chunks/BezDMT-k.js";import{S as At}from"../chunks/Rs6EvSgj.js";import{c as pt}from"../chunks/Dcrl4MPd.js";import{s as k,u as mt}from"../chunks/iREZRceN.js";import{g as Pt,a as Bt}from"../chunks/C6eE29Wt.js";const Ut=(H,u)=>{u.options=[...u.options,{name:"",price_add:0,description:"",display_order:u.options.length}]},Mt=async(H,u,x,m,p,R)=>{mt("loading",!0);try{if(!u?.id){k("error","로그인이 필요합니다.");return}if(await x.services.update(m.id,{title:p.title,content:p.content,price:p.price,contact_info:p.contact_info}),p.images.length>0){const d=await R(m.id,p.images);await x.services.update(m.id,{images:d})}if(await x.service_options.delete_by_service_id(m.id),p.options.length>0){const d=p.options.filter(v=>v.name.trim()&&v.price_add>0).map(v=>({service_id:m.id,name:v.name.trim(),price_add:v.price_add,description:v.description?.trim()||null,display_order:v.display_order}));d.length>0&&await x.service_options.insert_bulk(d)}k("success","서비스가 수정되었습니다."),jt(`/service/${m.id}`,{replaceState:!0})}catch(d){console.error("서비스 수정 실패:",d),k("error","서비스 수정에 실패했습니다.")}finally{mt("loading",!1)}};var Vt=w('<meta name="description" content="서비스를 수정할 수 있는 문의 서비스 수정 페이지입니다.">'),Zt=w('<button slot="left" class="flex items-center"><!></button>'),zt=w('<h1 slot="center" class="font-semibold"></h1>'),Et=w('<div class="relative ml-3 min-w-max"><div class="aspect-[4/3] h-24 w-32 overflow-hidden rounded-lg"><img class="h-full w-full object-cover" loading="eager"></div> <button aria-label="삭제"><svg class="absolute -top-1 -right-1" xmlns="http://www.w3.org/2000/svg" width="1.3rem" height="1.3rem" viewBox="0 0 24 24"><path d="m8.4 17l3.6-3.6l3.6 3.6l1.4-1.4l-3.6-3.6L17 8.4L15.6 7L12 10.6L8.4 7L7 8.4l3.6 3.6L7 15.6zm3.6 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"></path></svg></button></div>'),It=w('<div class="rounded-lg border border-gray-200 bg-gray-50 p-4"><div class="mb-3 flex items-center justify-between"><span class="text-sm font-medium text-gray-700"></span> <button class="text-sm text-gray-500 hover:text-gray-700" type="button">삭제</button></div> <div class="space-y-3"><div><input type="text" placeholder="옵션 이름 (예: 소스파일 제공)" class="input input-bordered h-11 w-full text-sm focus:outline-none focus:border-gray-400"></div> <div><input type="number" placeholder="추가 금액 (원)" class="input input-bordered h-11 w-full text-sm focus:outline-none focus:border-gray-400"></div> <div><input type="text" placeholder="설명 (선택)" class="input input-bordered h-11 w-full text-sm focus:outline-none focus:border-gray-400"></div></div></div>'),qt=w('<!> <main class="mx-4"><div><span class="ml-1 text-sm font-medium">서비스 이미지</span> <p class="mt-1 ml-1 text-xs text-gray-500">권장 크기: 652x488px (4:3 비율), 최대 7개</p> <div class="mt-2 flex overflow-x-auto"><label for="input-file"><input type="file" id="input-file" accept="image/*," multiple class="hidden"> <div class="flex h-20 w-20 flex-col items-center justify-center gap-1 rounded-lg bg-gray-50"><svg width="20" height="20" viewBox="0 0 24 21" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.14 2.33333L16.275 4.66667H21V18.6667H2.33333V4.66667H7.05833L9.19333 2.33333H14.14ZM15.1667 0H8.16667L6.03167 2.33333H2.33333C1.05 2.33333 0 3.38333 0 4.66667V18.6667C0 19.95 1.05 21 2.33333 21H21C22.2833 21 23.3333 19.95 23.3333 18.6667V4.66667C23.3333 3.38333 22.2833 2.33333 21 2.33333H17.3017L15.1667 0ZM11.6667 8.16667C13.5917 8.16667 15.1667 9.74167 15.1667 11.6667C15.1667 13.5917 13.5917 15.1667 11.6667 15.1667C9.74167 15.1667 8.16667 13.5917 8.16667 11.6667C8.16667 9.74167 9.74167 8.16667 11.6667 8.16667ZM11.6667 5.83333C8.44667 5.83333 5.83333 8.44667 5.83333 11.6667C5.83333 14.8867 8.44667 17.5 11.6667 17.5C14.8867 17.5 17.5 14.8867 17.5 11.6667C17.5 8.44667 14.8867 5.83333 11.6667 5.83333Z" fill="#A9A9A9"></path></svg> <span class="text-xs text-gray-900"> </span></div></label> <div class="flex flex-row"></div></div></div> <div class="mt-4"><p class="ml-1 text-sm font-medium">서비스 제목</p> <div class="mt-2"><input type="text" class="input input-bordered focus:border-primary h-[52px] w-full focus:outline-none"></div></div> <div class="mt-4"><p class="ml-1 text-sm font-medium">서비스 가격</p> <div class="mt-2"><input type="number" class="input input-bordered focus:border-primary h-[52px] w-full focus:outline-none"></div></div> <div class="mt-4"><p class="ml-1 text-sm font-medium">추가 옵션 (선택)</p> <p class="mt-1 ml-1 text-xs text-gray-500">고객이 선택할 수 있는 추가 옵션을 등록해보세요</p> <div class="mt-3 space-y-3"><!> <button type="button" class="flex h-11 w-full items-center justify-center rounded-lg border-2 border-dashed border-gray-300 text-sm text-gray-600 hover:border-gray-400 hover:text-gray-700">+ 옵션 추가</button></div></div> <div class="mt-4"><p class="ml-1 text-sm font-medium">문의 연락처</p> <p class="mt-1 ml-1 text-xs text-gray-500">고객이 서비스 문의 시 연락할 수 있는 연락처를 입력해주세요</p> <div class="mt-2"><input type="text" placeholder="예: 010-1234-5678, 카카오톡 링크, 인스타그램 링크" class="input input-bordered focus:border-primary h-[52px] w-full focus:outline-none"></div></div> <div class="mt-4 flex flex-col"><p class="ml-1 text-sm font-medium">서비스 내용</p> <div class="mt-2"><!></div></div></main> <div class="fixed bottom-0 w-full max-w-screen-md bg-white px-5 py-3.5"><div class="pb-safe flex space-x-2"><button class="btn btn-primary flex flex-1 items-center justify-center">수정하기</button></div></div>',1);function oe(H,u){bt(u,!0);const x=Pt(),m=Bt();let{service:p,service_options:R}=u.data,d=V(p),v=V(R),a=V({title:d.title||"",content:d.content||"",price:d.price||0,contact_info:d.contact_info||"",images:d.images||[],options:v||[]});const vt=s=>{const i=s.target.files;let r=[...a.images];for(let n=0;n<i.length;n++){i[n].uri=URL.createObjectURL(i[n]);const l=new Image;l.onload=()=>{const c=l.width/l.height,f=l.width>=652&&l.height>=488,g=c>=1.3&&c<=1.4;(!f||!g)&&k("info","권장 크기: 652x488px (4:3 비율)로 업로드하면 더 좋은 품질을 얻을 수 있어요!")},l.src=i[n].uri,r.push(i[n])}if(r.length>7){alert("이미지 개수는 7개를 초과할 수 없습니다.");return}a.images=r},ut=s=>{const i=[...a.images];i.splice(s,1),a.images=i},_t=s=>{const i=[...a.options];i.splice(s,1),i.forEach((r,n)=>r.display_order=n),a.options=i},ft=async(s,i)=>Promise.all(i.map(async(r,n)=>{if(r?.name===void 0)return{uri:r.uri};const l=r.name.split(".").pop(),c=`${s}/${Date.now()}-${n}.${l}`;return await m.service_images.upload(c,r),{uri:`${Ht}/storage/v1/object/public/services/images/${c}`}}));var Z=qt();kt(s=>{var i=Vt();$t.title="서비스 수정 | 문",h(s,i)});var z=yt(Z);Tt(z,{$$slots:{left:(s,i)=>{var r=Zt();r.__click=function(...l){Rt?.apply(this,l)};var n=e(r);St(n,{size:26,get color(){return pt.gray[600]}}),t(r),h(s,r)},center:(s,i)=>{var r=zt();r.textContent="서비스 수정",h(s,r)}}});var j=o(z,2),S=e(j),E=o(e(S),4),T=e(E),I=e(T);I.__change=vt;var q=o(I,2),D=o(e(q),2),gt=e(D);t(D),t(q),t(T);var G=o(T,2);dt(G,21,()=>a.images,ct,(s,i,r)=>{var n=Et(),l=e(n),c=e(l);C(c,"key",r),t(l);var f=o(l,2);f.__click=()=>ut(r);var g=e(f),$=e(g);t(g),t(f),t(n),lt(()=>{C(c,"src",_(i).uri),C(c,"alt",_(i).name||"service image"),C($,"fill",pt.gray[900])}),h(s,n)}),t(G),t(E),t(S);var A=o(S,2),O=o(e(A),2),F=e(O);b(F),t(O),t(A);var P=o(A,2),J=o(e(P),2),K=e(J);b(K),t(J),t(P);var B=o(P,2),N=o(e(B),4),Q=e(N);dt(Q,17,()=>a.options,ct,(s,i,r)=>{var n=It(),l=e(n),c=e(l);c.textContent=`옵션 ${r+1}`;var f=o(c,2);f.__click=()=>_t(r),t(l);var g=o(l,2),$=e(g),at=e($);b(at),t($);var M=o($,2),rt=e(M);b(rt),t(M);var ot=o(M,2),nt=e(ot);b(nt),t(ot),t(g),t(n),y(at,()=>_(i).name,L=>_(i).name=L),y(rt,()=>_(i).price_add,L=>_(i).price_add=L),y(nt,()=>_(i).description,L=>_(i).description=L),h(s,n)});var xt=o(Q,2);xt.__click=[Ut,a],t(N),t(B);var U=o(B,2),W=o(e(U),4),X=e(W);b(X),t(W),t(U);var Y=o(U,2),tt=o(e(Y),2),ht=e(tt);At(ht,{get content(){return a.content},set content(s){a.content=s}}),t(tt),t(Y),t(j);var et=o(j,2),it=e(et),st=e(it);st.__click=[Mt,x,m,d,a,ft],t(it),t(et),lt(()=>{Lt(gt,`${a.images.length??""}/7`),st.disabled=a.title.length===0||a.content.length===0||a.price===0||a.contact_info.length===0||a.images.length===0}),y(F,()=>a.title,s=>a.title=s),y(K,()=>a.price,s=>a.price=s),y(X,()=>a.contact_info,s=>a.contact_info=s),h(H,Z),wt()}Ct(["click","change"]);export{oe as component};
